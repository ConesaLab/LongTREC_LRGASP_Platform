<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Challenge 3</title>
    <style>

        html,body{
            margin: 0;
            padding: 0;
        }

        header h1{
            font-family: 'Open Sans', sans-serif;
            font-size: 3vw;
            color: white;
            background-color: #ec8551;
            display: flex;
            text-align: center;
            align-items: center;
            justify-content: center;
            max-width: 100vw;
            height: 20vh;
            border: 0.1vw solid #22252a;
        }

        header h2{
            font-family: 'Open Sans', sans-serif;
            font-size: 1.5vw;
        }

        .challenge3-row-1,
        .challenge3-row-3{
            display: flex;
            flex-direction: row;
        }

        .challenge3-row-1{
            margin-top: 1vh;
        }

        .challenge3-row-2{
            margin-top: 3vh;
            margin-bottom: 3vh;
            display: flex;
            align-items: center;  /* Vertically center items */
            text-align: center;
            justify-content: flex-start; /* Or flex-end or center horizontally */
            position: relative; /* If you still want to place the button with margin-left */
        }

        .run_script_button{
            background-color: #ec8551;
            border: 0.1vw solid black;
            color: white;
            border-radius: 0.25vw;
            cursor: pointer;
            width: 5vw;
            height: 5vh;
            margin-left: 30vw;
            font-size: 0.8vw;
        }

        .add-remove-dataset{
            display: flex;
            margin-left: 50vw;
            max-width: 10vw;
            width: 10vw;
            text-align: center;
            align-items: center;
            justify-content: center;
            font-family: 'Open Sans', sans-serif;

        }

        /* The buttons keep consistent styling */
            .add-dataset, .remove-dataset {
            font-size: 0.8vw;
            display: inline-block;  /* or block */
            background-color: #ec8551; /* or override for remove button */
            border: black 0.05vw solid;
            color: white;
            border-radius: 0.25vw;
            width: 10vw;
            height: 3vh;
        }

        .challenge3-modes{
            text-align: center;
            align-items: center;
            justify-content: center;
            font-family: 'Open Sans', sans-serif;
            font-size: 2vw;
            color: #ec8551;
            margin-left: 2vw;
            margin-right: 4vw;
            margin-top: 2vw;
            padding-top: 2vw;
            width: 20vw;
            height: 20vh;
        }

        .toggle-switch input {
            display: none;
        }

        .slider-container{
            display: flex;
            align-items: center;
            text-align: center;
            justify-content: center;

        }

        #slider-label-custom,
        #slider-label-LRGASP{
            margin-left: 0.5vw;
            margin-right: 0.5vw;
            font-size: 1vw;
            color: black;
        }

        .toggle-switch .slider {
            position: relative;
            display: inline-block;
            width: 3vw;
            height: 2.6vh;
            background-color: #ccc;
            border-radius: 2.5vw;
            transition: 0.4s;
        }

        .toggle-switch .slider:before {
            content: "";
            position: absolute;
            height: 1.85vh;
            width: 1vw;
            border-radius: 50%;
            left: 0.2vw;
            bottom: 0.4vh;
            background-color: white;
            transition: 0.4s;
            cursor: pointer;
        }

        .toggle-switch input:checked + .slider {
            background-color: #4CAF50; /* Green color when checked */
        }

        .toggle-switch input:checked + .slider:before {
            transform: translateX(1.6vw); /* Move circle to the right */
        }

        .box_dataset1,
        .box_dataset2{
            font-family: 'Open Sans', sans-serif;
            font-size: 0.875vw;
            display: flex;
            max-width: 65vw;
            width: 65vw;
            border: 0.15vw dashed black;
        }

        .box_dataset1{
            margin-top: 2vh;
            height: 40vh;
        }

        .box_dataset2{
            position: absolute;
            margin-left: 26vw;
            height: 35vh;
        }


        .input_data_1,
        .input_data_2{
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            margin-left: 1vw;
        }

        .input_meta_1{
            margin-left: 6.5vw;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .dropdown{
            max-width: 10vw;
            width: 10vw;
            height: 3.25vh;
            border-radius: 0.26vw;
            margin-top: 0.78125vw;
            padding: 0.26vw;
            border: 0.05vw solid black;
        }

        #organism-dropdown{
            position: relative;
        }

        #organism-custom-input{
            border: 0;
            position: absolute;
            margin-top: -1.55vw;
            margin-left: 4.5vw;
            max-width: 8vw;
        }

        #organism-custom-input:focus,
        #platform-custom-input:focus,
        #library-custom-input:focus,
        #platform-custom-input2:focus,
        #library-custom-input2:focus{
            outline: none;
        }

        .transcriptome-custom-file-upload,
        .transcriptome-custom-file-upload2{
            display: inline-block;
            padding: 0.26vw;
            background-color: #ec8551;
            color: white;
            border-radius: 0.26vw;
            cursor: pointer;
            text-align: center;
            border: 0.052vw solid black;
            position: absolute;
            margin-top: 0.78vw;
            margin-left: 10.5vw;
            max-width: 10vw;
            height: 3.25vh;
        }

        #transcriptome-file-display1,
        #transcriptome-file-display2{
            display: inline-block;
            vertical-align: middle;
            border: 0.052vw solid black;
            border-radius: 0.261vw;
            padding: 0.261vw;
            max-width: 10vw;
            width: 10vw;
            height: 3.25vh;
            margin-top: 0.78vw;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #transcriptome-label,
        #transcriptome-label2{
            position: absolute;
            margin-top: 2vh;
            margin-left: -7.5vw;
        }

        .annotation-custom-file-upload,
        .reference-custom-file-upload,
        .coverage-custom-file-upload,
        .cage-custom-file-upload,
        .quant-custom-file-upload,
        .polyA-custom-file-upload,
        .annotation-custom-file-upload2,
        .reference-custom-file-upload2,
        .coverage-custom-file-upload2,
        .cage-custom-file-upload2,
        .quant-custom-file-upload2,
        .polyA-custom-file-upload2{
            position: absolute;
            display: inline-block;
            padding: 0.261vw;
            background-color: #ec8551;
            color: white;
            border-radius: 0.261vw;
            cursor: pointer;
            text-align: center;
            border: 0.0521vw solid black;
            margin-top: -3.25vh;
            margin-left: 0.5vw;
            max-width: 10vw;
            height: 3.25vh;
        }

        .transcriptome-custom-file-upload:hover,
        .transcriptome-custom-file-upload2:hover,
        .annotation-custom-file-upload:hover,
        .reference-custom-file-upload:hover,
        .coverage-custom-file-upload:hover,
        .cage-custom-file-upload:hover,
        .quant-custom-file-upload:hover,
        .polyA-custom-file-upload:hover,
        .annotation-custom-file-upload2:hover,
        .reference-custom-file-upload2:hover,
        .coverage-custom-file-upload2:hover,
        .custom-file-upload-sirv1:hover,
        .custom-file-upload-ercc1:hover,
        .custom-file-upload-sequin1:hover,
        .custom-file-upload-sirv2:hover,
        .custom-file-upload-ercc2:hover,
        .custom-file-upload-sequin2:hover,
        .run_script_button:hover,
        .add-dataset:hover,
        .remove-dataset:hover,
        .question-mark:hover,
        .cage-custom-file-upload2:hover,
        .quant-custom-file-upload2:hover,
        .polyA-custom-file-upload2:hover {
            background-color: #da7949 !important;
        }

        .coverage-custom-file-upload{
            max-width: 10vw;
        }

        #annotation-file-display1,
        #reference-file-display1,
        #coverage-file-display1,
        #cage-file-display1,
        #quant-file-display1,
        #polyA-file-display1,
        #annotation-file-display2,
        #reference-file-display2,
        #coverage-file-display2,
        #cage-file-display2,
        #quant-file-display2,
        #polyA-file-display2{
            position: absolute;
            display: inline-block;
            border-radius: 0.261vw;
            padding: 0.142vw;
            max-width: 8vw;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            height: 2.5vh;
            margin-top: -1.56vw;
            margin-left: -9.75vw;
            background-color: white;

        }

        .question-mark {
            background-color: #ec8551;
            color: white;
            font-weight: bold;
            border-radius: 0.25vw;
            padding: 0.15vw 0.4vw;
            font-size: 0.7vw;
            display: inline-block;
            text-align: center;
            border: black 0.05vw solid;
        }

        .tooltip-container {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .tooltip-text {
            display: none;
            position: absolute;
            background-color: #ec8551;
            color: white;
            padding: 0.4vw;
            border-radius: 0.25vw;
            font-size: 0.6vw;
            width: 10.5vw;
            text-align: center;
            top: 1.25vw;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0.2vw 0.4vw rgba(0, 0, 0, 0.2);
        }

        /* Show tooltip when hovering */
        .tooltip-container:hover .tooltip-text {
            background-color: #da7949 !important;
            display: block;
        }

        #platform-custom-input,
        #platform-custom-input2{
            border: 0;
            position: absolute;
            margin-top: -2.75vh;
            margin-left: 3.91vw;
            height: 2.5vh;
            max-width: 8vw;
        }



        #library-custom-input,
        #library-custom-input2{
            border: 0;
            position: absolute;
            margin-top: -2.75vh;
            margin-left: 8.25vw;
            height: 2.5vh;
            max-width: 8vw;
        }

        .sirvs_data{
            margin-left: 2.62vw;
            margin-top: 0.0926vh;
            position: relative;
        }

        .custom-file-upload-sirv1,
        .custom-file-upload-ercc1,
        .custom-file-upload-sequin1,
        .custom-file-upload-sirv2,
        .custom-file-upload-ercc2,
        .custom-file-upload-sequin2{
            font-size: 0.7vw;
            position: absolute;
            display: inline-block;
            padding: 0.261vw;
            background-color: #ec8551;
            color: white;
            border-radius: 0.261vw;
            cursor: pointer;
            text-align: center;
            border: 0.0521vw solid black;
            margin-top: 0;
            margin-left: 10.5vw;
            max-width: 8vw;
            width: 6vw;
            height: 3.25vh;
        }

        #sirv-file-name1,
        #ercc-file-name1,
        #sequin-file-name1,
        #sirv-file-name2,
        #ercc-file-name2,
        #sequin-file-name2{
            position: absolute;
            display: inline-block;
            border: 0.0521vw solid black;
            border-radius: 0.261vw;
            padding: 0.261vw;
            max-width: 10vw;
            height: 3.25vh;
            background-color: white;
            width: 10vw;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .comparison{
            align-items: center;
            justify-content: center;
            font-family: 'Open Sans', sans-serif;
            font-size: 2vw;
            color: #ec8551;
            margin-left: 2vw;
            margin-right: 4vw;
            padding-left: 3vw;
            margin-top: -10vh;
            margin-bottom: 10vh;
            width: 20vw;
            height: 20vh;
        }

        .shift-comparison{
            padding-left: 2.5vw;
        }

        #comparison-dropdown {
            font-size: 0.8vw;
            background-color: white;
            color: #6c6c6c;
            border: 0.05vw solid black;
            border-radius: 0.25vw;
            width: 13vw;
            height: auto; /* Adjust height for multiple selections */
            text-align: left;
        }

        /* Style for the Choices.js dropdown */
        .choices {
            width: 13vw;
            color: black;
        }

        .choices__list--multiple .choices__item {
            background-color: #ec8551 !important; /* Replace with your desired color */
            color: white; /* Change text color for contrast */
        }

        .vertical-line{
            margin-top: -74vh;
            border: #22252a 0.05vw solid;
            width: 0.1vw;
            height: 69vh;
            margin-left: 23vw;
        }

        /* Overlay and Progress */
        #overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        #progress-container {
            background: white;
            color: black;
            padding: 1vw;
            border-radius: 0.4vw;
            text-align: center;
            width: 40vw;
        }

        #progress-bar-container {
            width: 80%;
            background-color: #ddd;
            border-radius: 0.2vw;
            overflow: hidden;
        }

        #progress-bar {
            width: 0;
            height: 2vh;
            background: #4CAF50;
        }

        #terminal-log-container{
            width:80%;
            height:15vw;
            background-color:black;
            color: limegreen;
            border: black 0.05vw solid;
            overflow-y:scroll;
            padding:0.5vw;
            border-radius: 1.5vw;
            text-align: left;
        }


    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

</head>

<body>
{% extends "base.html" %}
{% block content %}
    <header>
        <h1>Transcriptome Reconstruction <br> with Annotation File</h1>

        <form id="script-form" action="{{ url_for('run_script_challenge3') }}" method="POST" enctype="multipart/form-data">
        <div class="challenge3-row-1">
            <div class="challenge3-modes">
                <h2>Is your data derived from <br> a LRGASP dataset?</h2>
                <div class="slider-container">
                    <span id="slider-label-custom">Custom</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="toggleSwitchLRGASP">
                        <span class="slider"></span>
                    </label>
                    <span id="slider-label-LRGASP">LRGASP</span>
                </div>

            </div>

            <div class="box_dataset1">
                <div class="input_data_1">
                    <!-- Organsim -->
                    <div class="organism_dataset1">
                        <label for="organism-dropdown">Organism: </label>
                        <select id="organism-dropdown" class="dropdown" name="organism" required>
                            <option value="" disabled selected>Choose organism...</option>
                            <option value="mouse">Mouse</option>
                            <option value="human">Human</option>
                            <option value="custom">Custom</option>
                        </select>
                        <input type="text" id="organism-custom-input" name="organism_custom" placeholder="Please type..." style="display: none;">
                    </div>

                    <!-- Transcriptome File -->
                    <div class="transcriptome_dataset1">
                        <span id="transcriptome-label">Transcriptome file:</span>
                        <label for="transcriptome_dataset1" class="transcriptome-custom-file-upload">Choose File</label>
                        <span id="transcriptome-file-display1">No file chosen</span>
                        <input type="file" id="transcriptome_dataset1" name="file" onchange="displayTranscriptomeFile('1')" required style="display: none;">
                    </div>


                    <!-- Annotation File -->
                    <div class="dropdown-container annotation-container">
                        <label for="annotation-dropdown">Annotation File: </label>
                        <select id="annotation-dropdown" class="dropdown" name="annotation" onchange="toggleFileInput('annotation-dropdown', 'annotation-file-upload')">
                            <option value="default" selected>LRGASP Data</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <!-- Hidden Annotation Upload -->
                    <div id="annotation-file-upload" style="display: none">
                        <label for="annotation-file" class="annotation-custom-file-upload">Choose File</label>
                        <span id="annotation-file-display1">No file chosen</span>
                        <input type="file" id="annotation-file" name="annotation_file" onchange="displayFileName('annotation-file', 'annotation-file-display1')" required style="display: none;">
                    </div>

                    <!-- Reference File -->
                    <div class="dropdown-container reference-container">
                        <label for="reference-dropdown">Reference Genome File: </label>
                        <select id="reference-dropdown" class="dropdown" name="reference" onchange="toggleFileInput('reference-dropdown', 'reference-file-upload')">
                            <option value="default" selected>LRGASP Data</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <!-- Hidden Reference Upload -->
                    <div id="reference-file-upload" style="display: none">
                        <label for="reference-file" class="reference-custom-file-upload">Choose File</label>
                        <span id="reference-file-display1">No file chosen</span>
                        <input type="file" id="reference-file" name="reference_file" onchange="displayFileName('reference-file', 'reference-file-display1')" required style="display: none;">
                    </div>

                    <!-- Coverage Directory -->
                    <div class="dropdown-container coverage-container">
                        <div class="tooltip-container">
                            <span class="question-mark">?</span>
                            <div class="tooltip-text">Provide the directory containing the short-read Splice Junctions .out.tab files generated using Illumina. Even if you only have a single sample, it must be in its own directory.</div>
                        </div>
                        <label for="coverage-dropdown">Coverage Directory: </label>
                        <select id="coverage-dropdown" class="dropdown" name="coverage_directory" onchange="toggleFileInput('coverage-dropdown', 'coverage-file-upload')">
                            <option value="default" selected>LRGASP Data</option>
                            <option value="custom">Custom</option>
                            <option value="none">None</option>
                        </select>
                    </div>

                    <!-- Hidden Coverage Dir Upload -->
                    <div id="coverage-file-upload" style="display: none">
                        <label for="coverage-file" class="coverage-custom-file-upload">Choose Directory</label>
                        <span id="coverage-file-display1">No directory chosen</span>
                        <input type="file" id="coverage-file" name="coverage_dir" webkitdirectory onchange="displayDirectoryName('coverage-file', 'coverage-file-display1')" required style="display: none;">
                    </div>

                    <!-- CAGE File -->
                    <div class="dropdown-container cage-container">
                        <label for="cage-dropdown">CAGE Peak File: </label>
                        <select id="cage-dropdown" class="dropdown" name="cage" onchange="toggleFileInput('cage-dropdown', 'cage-file-upload')">
                            <option value="reference" selected>Reference</option>
                            <option value="default" selected>LRGASP Data</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <!-- Hidden CAGE Upload -->
                    <div id="cage-file-upload" style="display: none">
                        <label for="cage-file" class="cage-custom-file-upload">Choose File</label>
                        <span id="cage-file-display1">No file chosen</span>
                        <input type="file" id="cage-file" name="cage_file" onchange="displayFileName('cage-file', 'cage-file-display1')" required style="display: none;">
                    </div>

                    <!-- QUANT File -->
                    <div class="dropdown-container quant-container">
                        <label for="quant-dropdown">Quant Peak File: </label>
                        <select id="quant-dropdown" class="dropdown" name="quant" onchange="toggleFileInput('quant-dropdown', 'quant-file-upload')">
                            <option value="reference" selected>Reference</option>
                            <option value="default" selected>LRGASP Data</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <!-- Hidden QUANT Upload -->
                    <div id="quant-file-upload" style="display: none">
                        <label for="quant-file" class="quant-custom-file-upload">Choose File</label>
                        <span id="quant-file-display1">No file chosen</span>
                        <input type="file" id="quant-file" name="quant_file" onchange="displayFileName('quant-file', 'quant-file-display1')" required style="display: none;">
                    </div>

                    <!-- PolyA File -->
                    <div class="dropdown-container polyA-container">
                        <label for="polyA-dropdown">PolyA Motif File: </label>
                        <select id="polyA-dropdown" class="dropdown" name="polyA" onchange="toggleFileInput('polyA-dropdown', 'polyA-file-upload')">
                            <option value="reference" selected>Reference</option>
                            <option value="default" selected>LRGASP Data</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <!-- Hidden PolyA Upload -->
                    <div id="polyA-file-upload" style="display: none">
                        <label for="polyA-file" class="polyA-custom-file-upload">Choose File</label>
                        <span id="polyA-file-display1">No file chosen</span>
                        <input type="file" id="polyA-file" name="polyA_file" onchange="displayFileName('polyA-file', 'polyA-file-display1')" required style="display: none;">
                    </div>
                </div>

                <div class="input_meta_1">
                    <!-- Tool Name Input Box -->
                    <div class="dropdown-container tool-name-container">
                        <label for="tool-input">Tool Name: </label>
                        <input type="text" id="tool-input" class="dropdown" name="tool" placeholder=" your_tool">
                    </div>

                    <!-- Platform Dropdown -->
                    <div class="dropdown-container platform-dropdown-container">
                        <label for="platform-dropdown">Platform: </label>
                        <select id="platform-dropdown" class="dropdown" name="platform" required>
                            <option value="PacBio" selected>PacBio</option>
                            <option value="ONT">Oxford Nanopore Technologies</option>
                         <option value="custom">Custom</option>
                        </select>
                        <!-- Hidden text input for custom platform -->
                        <input class="custom-platform-box" type="text" id="platform-custom-input" name="platform_custom" placeholder="Enter Platform..." style="display: none;">
                    </div>

                    <!-- Library Preparation Dropdown -->
                    <div class="dropdown-container library-dropdown-container">
                        <label for="library-dropdown">Library Preparation: </label>
                        <select id="library-dropdown" class="dropdown" name="library_preparation" required>
                            <option value="cDNA" selected>cDNA</option>
                            <option value="dRNA">directRNA</option>
                            <option value="R2C2">R2C2</option>
                            <option value="CapTrap">CapTrap</option>
                            <option value="custom">Custom</option>
                        </select>
                        <!-- Hidden text input for custom library preparation -->
                        <input class="custom-lib_prep-box" type="text" id="library-custom-input" name="library_custom" placeholder="Please type..." style="display: none;">
                    </div>

                    <!-- Data Category Dropdown -->
                    <div class="dropdown-container data-category-container">
                        <label for="data-category-dropdown">Data Category: </label>
                        <select id="data-category-dropdown" class="dropdown" name="data_category" required>
                            <option value="NA" selected>NA</option>
                            <option value="LS">LS</option>
                            <option value="SO">SO</option>
                            <option value="LO">LO</option>
                        </select>
                    </div>
                </div>

                <div class="sirvs_data">
                    <label style="font-weight: bold">Select the Spike-In types present</label>

                    <!-- SIRV -->
                    <div class="sirv-checkbox-container1">
                        <label>
                            <input type="checkbox" id="sirv-checkbox1" value="SIRV" onclick="toggleFileInputSIRVs('sirv', '1')"> SIRV
                        </label>
                    </div>

                    <div id="sirv-file-container1" style="display: none; position: absolute">
                        <label for="sirv-file-upload1" class="custom-file-upload-sirv1">Choose SIRV</label>
                        <input type="file" id="sirv-file-upload1" name="sirv_file1" onchange="displayFileNameSIRVs('sirv', '1')" hidden>
                        <div id="sirv-file-name1" class="file-name">No file chosen...</div>
                    </div>

                    <br>
                    <br>

                    <!-- ERCC -->
                    <div class="ercc-checkbox-container1">
                        <label>
                            <input type="checkbox" id="ercc-checkbox1" value="ERCC" onclick="toggleFileInputSIRVs('ercc', '1')"> ERCC
                        </label>
                    </div>

                    <div id="ercc-file-container1" style="display: none; position: absolute">
                        <label for="ercc-file-upload1" class="custom-file-upload-ercc1">Choose ERCC</label>
                        <input type="file" id="ercc-file-upload1" name="ercc_file1" onchange="displayFileNameSIRVs('ercc', '1')" hidden>
                        <div id="ercc-file-name1" class="file-name1">No file chosen...</div>
                    </div>

                    <br>
                    <br>

                    <!-- SEQUIN -->
                    <div class="sequin-checkbox-container1">
                        <label>
                            <input type="checkbox" id="sequin-checkbox1" value="SEQUIN" onclick="toggleFileInputSIRVs('sequin', '1')"> SEQUIN
                        </label>
                    </div>

                    <div id="sequin-file-container1" style="display: none; position: absolute">
                        <label for="sequin-file-upload1" class="custom-file-upload-sequin1">Choose SEQUIN</label>
                        <input type="file" id="sequin-file-upload1" name="sequin_file1" onchange="displayFileNameSIRVs('sequin', '1')" hidden>
                        <div id="sequin-file-name1" class="file-name">No file chosen...</div>
                    </div>

                </div>
            </div>
        </div>

        <div class="challenge3-row-2">
            <div class="add-remove-dataset">
                <button id="add-dataset-button" class="add-dataset">+ Add Dataset</button>
                <button id="remove-dataset-button" class="remove-dataset" style="display: none;" name="remove-dataset-button">- Remove Dataset</button>
            </div>

            <button class="run_script_button" type="button" onclick="start_progress(event)">Run Script</button>
        </div>


        <div class="challenge3-row-3">
            <div class="comparison">
                <h2 class="shift-comparison">Comparison</h2>
                <select id="comparison-dropdown" name="comparison-dropdown" multiple>
                    <option name="comparison_option_bambu" value="Bambu"> Bambu</option>
                    <option name="comparison_option_FLAIR" value="FLAIR"> FLAIR</option>
                    <option name="comparison_option_Lyric" value="Lyric"> Lyric*</option>
                    <option name="comparison_option_IsoTools" value="IsoTools"> IsoTools</option>
                    <option name="comparison_option_Mandalorion" value="Mandalorion"> Mandalorion</option>
                    <option name="comparison_option_Iso_IB" value="Iso_IB"> Iso_IB</option>
                    <option name="comparison_option_FLAMES" value="FLAMES"> FLAMES</option>
                    <option name="comparison_option_IsoQuant" value="IsoQuant"> IsoQuant</option>
                    <option name="comparison_option_Spectra" value="Spectra"> Spectra</option>
                    <option name="comparison_option_TALON_LAPA" value="TALON_LAPA"> TALON_LAPA</option>
                    <option name="comparison_option_StringTie2" value="StringTie2"> StringTie2</option>
                </select>
            </div>

            <div class="box_dataset2" style="display: none">
                <div class="input_data_2">
                    <!-- Transcriptome File -->
                    <div class="transcriptome_dataset2">
                        <span id="transcriptome-label2">Transcriptome file:</span>
                        <label for="transcriptome_dataset2" class="transcriptome-custom-file-upload2">Choose File</label>
                        <span id="transcriptome-file-display2">No file chosen</span>
                        <input type="file" id="transcriptome_dataset2" name="file-2" onchange="displayTranscriptomeFile('2')" required style="display: none;">
                    </div>

                    <!-- Annotation File -->
                    <div class="dropdown-container annotation-container">
                        <label for="annotation-dropdown2">Annotation File: </label>
                        <select id="annotation-dropdown2" class="dropdown" name="annotation-2" onchange="toggleFileInput('annotation-dropdown2', 'annotation-file-upload2')">
                            <option value="default" selected>LRGASP Data</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <!-- Hidden Annotation Upload -->
                    <div id="annotation-file-upload2" style="display: none">
                        <label for="annotation-file2" class="annotation-custom-file-upload2">Choose File</label>
                        <span id="annotation-file-display2">No file chosen</span>
                        <input type="file" id="annotation-file2" name="annotation_file2" onchange="displayFileName('annotation-file2', 'annotation-file-display2')" required style="display: none;">
                    </div>

                    <!-- Reference File -->
                    <div class="dropdown-container reference-container">
                        <label for="reference-dropdown2">Reference Genome File: </label>
                        <select id="reference-dropdown2" class="dropdown" name="reference-2" onchange="toggleFileInput('reference-dropdown2', 'reference-file-upload2')">
                            <option value="default" selected>LRGASP Data</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <!-- Hidden Reference Upload -->
                    <div id="reference-file-upload2" style="display: none">
                        <label for="reference-file2" class="reference-custom-file-upload2">Choose File</label>
                        <span id="reference-file-display2">No file chosen</span>
                        <input type="file" id="reference-file2" name="reference_file2" onchange="displayFileName('reference-file2', 'reference-file-display2')" required style="display: none;">
                    </div>

                    <!-- Coverage Directory -->
                    <div class="dropdown-container coverage-container">
                        <div class="tooltip-container">
                            <span class="question-mark">?</span>
                            <div class="tooltip-text">Provide the directory containing the short-read Splice Junctions .out.tab files generated using Illumina. Even if you only have a single sample, it must be in its own directory.</div>
                        </div>
                        <label for="coverage-dropdown2">Coverage Directory: </label>
                        <select id="coverage-dropdown2" class="dropdown" name="coverage_directory2" onchange="toggleFileInput('coverage-dropdown2', 'coverage-file-upload2')">
                            <option value="default" selected>LRGASP Data</option>
                            <option value="custom">Custom</option>
                            <option value="none">None</option>
                        </select>
                    </div>

                    <!-- Hidden Coverage Dir Upload -->
                    <div id="coverage-file-upload2" style="display: none">
                        <label for="coverage-file2" class="coverage-custom-file-upload2">Choose Directory</label>
                        <span id="coverage-file-display2">No directory chosen</span>
                        <input type="file" id="coverage-file2" name="coverage_dir2" webkitdirectory onchange="displayDirectoryName('coverage-file2', 'coverage-file-display2')" required style="display: none;">
                    </div>

                    <!-- CAGE File -->
                    <div class="dropdown-container cage-container">
                        <label for="cage-dropdown2">CAGE Peak File: </label>
                        <select id="cage-dropdown2" class="dropdown" name="cage2" onchange="toggleFileInput('cage-dropdown2', 'cage-file-upload2')">
                            <option value="reference" selected>Reference</option>
                            <option value="default" selected>LRGASP Data</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <!-- Hidden CAGE Upload -->
                    <div id="cage-file-upload2" style="display: none">
                        <label for="cage-file2" class="cage-custom-file-upload2">Choose File</label>
                        <span id="cage-file-display2">No file chosen</span>
                        <input type="file" id="cage-file2" name="cage_file2" onchange="displayFileName('cage-file2', 'cage-file-display2')" required style="display: none;">
                    </div>

                    <!-- QUANT File -->
                    <div class="dropdown-container quant-container">
                        <label for="quant-dropdown2">Quant Peak File: </label>
                        <select id="quant-dropdown2" class="dropdown" name="quant2" onchange="toggleFileInput('quant-dropdown2', 'quant-file-upload2')">
                            <option value="reference" selected>Reference</option>
                            <option value="default" selected>LRGASP Data</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <!-- Hidden QUANT Upload -->
                    <div id="quant-file-upload2" style="display: none">
                        <label for="quant-file2" class="quant-custom-file-upload2">Choose File</label>
                        <span id="quant-file-display2">No file chosen</span>
                        <input type="file" id="quant-file2" name="quant_file2" onchange="displayFileName('quant-file2', 'quant-file-display2')" required style="display: none;">
                    </div>

                    <!-- PolyA File -->
                    <div class="dropdown-container polyA-container">
                        <label for="polyA-dropdown2">PolyA Motif File: </label>
                        <select id="polyA-dropdown2" class="dropdown" name="polyA2" onchange="toggleFileInput('polyA-dropdown2', 'polyA-file-upload2')">
                            <option value="reference" selected>Reference</option>
                            <option value="default" selected>LRGASP Data</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <!-- Hidden PolyA Upload -->
                    <div id="polyA-file-upload2" style="display: none">
                        <label for="polyA-file2" class="polyA-custom-file-upload2">Choose File</label>
                        <span id="polyA-file-display2">No file chosen</span>
                        <input type="file" id="polyA-file2" name="polyA_file2" onchange="displayFileName('polyA-file2', 'polyA-file-display2')" required style="display: none;">
                    </div>
                </div>

                <div class="input_meta_1">
                    <!-- Platform Dropdown -->
                    <div class="dropdown-container platform-dropdown-container">
                        <label for="platform-dropdown2">Platform: </label>
                        <select id="platform-dropdown2" class="dropdown" name="platform2" required>
                            <option value="PacBio" selected>PacBio</option>
                            <option value="ONT">Oxford Nanopore Technologies</option>
                         <option value="custom">Custom</option>
                        </select>
                        <!-- Hidden text input for custom platform -->
                        <input class="custom-platform-box" type="text" id="platform-custom-input2" name="platform_custom2" placeholder="Enter Platform..." style="display: none;">
                    </div>

                    <!-- Library Preparation Dropdown -->
                    <div class="dropdown-container library-dropdown-container">
                        <label for="library-dropdown2">Library Preparation: </label>
                        <select id="library-dropdown2" class="dropdown" name="library_preparation2" required>
                            <option value="cDNA" selected>cDNA</option>
                            <option value="dRNA">directRNA</option>
                            <option value="R2C2">R2C2</option>
                            <option value="CapTrap">CapTrap</option>
                            <option value="custom">Custom</option>
                        </select>
                        <!-- Hidden text input for custom library preparation -->
                        <input class="custom-lib_prep-box" type="text" id="library-custom-input2" name="library_custom2" placeholder="Please type..." style="display: none;">
                    </div>

                    <!-- Data Category Dropdown -->
                    <div class="dropdown-container data-category-container">
                        <label for="data-category-dropdown2">Data Category: </label>
                        <select id="data-category-dropdown2" class="dropdown" name="data_category2" required>
                            <option value="NA" selected>NA</option>
                            <option value="LS">LS</option>
                            <option value="SO">SO</option>
                            <option value="LO">LO</option>
                        </select>
                    </div>
                </div>

                <div class="sirvs_data">
                    <label style="font-weight: bold">Select the Spike-In types present</label>

                    <!-- SIRV -->
                    <div class="sirv-checkbox-container2">
                        <label>
                            <input type="checkbox" id="sirv-checkbox2" value="SIRV" onclick="toggleFileInputSIRVs('sirv', '2')"> SIRV
                        </label>
                    </div>

                    <div id="sirv-file-container2" style="display: none; position: absolute">
                        <label for="sirv-file-upload2" class="custom-file-upload-sirv2">Choose SIRV</label>
                        <input type="file" id="sirv-file-upload2" name="sirv_file2" onchange="displayFileNameSIRVs('sirv', '2')" hidden>
                        <div id="sirv-file-name2" class="file-name">No file chosen...</div>
                    </div>

                    <br>
                    <br>

                    <!-- ERCC -->
                    <div class="ercc-checkbox-container2">
                        <label>
                            <input type="checkbox" id="ercc-checkbox2" value="ERCC" onclick="toggleFileInputSIRVs('ercc', '2')"> ERCC
                        </label>
                    </div>

                    <div id="ercc-file-container2" style="display: none; position: absolute">
                        <label for="ercc-file-upload2" class="custom-file-upload-ercc2">Choose ERCC</label>
                        <input type="file" id="ercc-file-upload2" name="ercc_file2" onchange="displayFileNameSIRVs('ercc', '2')" hidden>
                        <div id="ercc-file-name2" class="file-name2">No file chosen...</div>
                    </div>

                    <br>
                    <br>

                    <!-- SEQUIN -->
                    <div class="sequin-checkbox-container2">
                        <label>
                            <input type="checkbox" id="sequin-checkbox2" value="SEQUIN" onclick="toggleFileInputSIRVs('sequin', '2')"> SEQUIN
                        </label>
                    </div>

                    <div id="sequin-file-container2" style="display: none; position: absolute">
                        <label for="sequin-file-upload2" class="custom-file-upload-sequin2">Choose SEQUIN</label>
                        <input type="file" id="sequin-file-upload2" name="sequin_file2" onchange="displayFileNameSIRVs('sequin', '2')" hidden>
                        <div id="sequin-file-name2" class="file-name">No file chosen...</div>
                    </div>

                </div>
            </div>
        </div>

        <div class="vertical-line"></div>
        </form>

                  <!-- Overlay (Hidden by Default) -->
  <div id="overlay">
      <div id="progress-container">
          <h2 id="status-message">Booting Script...</h2>
          <div id="progress-bar-container">
              <div id="progress-bar"></div>
          </div>
          <div id="terminal-log-container">
            <p>Terminal logs will appear here...</p>
          </div>
      </div>
  </div>

    </header>

<script>
    // Generic function to toggle visibility of custom input fields
function toggleCustomInput(dropdownId, inputId) {
    document.getElementById(dropdownId).addEventListener("change", function() {
        var customInput = document.getElementById(inputId);
        customInput.style.display = this.value === "custom" ? "block" : "none";
    });
}

// Attach event listeners for multiple dropdowns
toggleCustomInput("organism-dropdown", "organism-custom-input");
toggleCustomInput("platform-dropdown", "platform-custom-input");
toggleCustomInput("library-dropdown", "library-custom-input");
toggleCustomInput("platform-dropdown2", "platform-custom-input2");
toggleCustomInput("library-dropdown2", "library-custom-input2");

function displayTranscriptomeFile(dataset) {
    var input = document.getElementById(`transcriptome_dataset${dataset}`);
    var fileNameDisplay = document.getElementById(`transcriptome-file-display${dataset}`);

    if (input.files.length > 0) {
        fileNameDisplay.textContent = input.files[0].name; // Show selected file name
    } else {
        fileNameDisplay.textContent = "No file chosen"; // Reset text if no file
    }
}

// Generic function to toggle file input visibility
function toggleFileInput(dropdownId, fileUploadId) {
    var dropdown = document.getElementById(dropdownId);
    var fileUpload = document.getElementById(fileUploadId);

    fileUpload.style.display = dropdown.value === "custom" ? "block" : "none";
}

// Generic function to display the selected file name
function displayFileName(inputId, displayId) {
    var input = document.getElementById(inputId);
    var fileNameDisplay = document.getElementById(displayId);

    fileNameDisplay.textContent = input.files.length > 0 ? input.files[0].name : "No file chosen";
}

function displayDirectoryName(inputId, displayId) {
    const input = document.getElementById(inputId);
    const fileNameDisplay = document.getElementById(displayId);

    if (input.files.length > 0) {
        const firstFile = input.files[0];
        const relativePath = firstFile.webkitRelativePath;
        const folderName = relativePath.split('/')[0];

        fileNameDisplay.textContent = folderName;
    } else {
        fileNameDisplay.textContent = "No directory chosen";
    }
}


function toggleFileInputSIRVs(type, dataset) {
    // type might be "sirv"
    // dataset is either null or '2'
    const container = document.getElementById(`${type}-file-container${dataset}`);
    const checkbox  = document.getElementById(`${type}-checkbox${dataset}`);

    if (!container || !checkbox) {
        console.warn(`Element not found for type: ${type}`);
        return;
    }

    if (checkbox.checked) {
        container.style.display = 'block';
    } else {
        container.style.display = 'none';

        // Clear the file selection when unchecking
        const fileUpload = document.getElementById(`${type}-file-upload${dataset}`);
        const fileName   = document.getElementById(`${type}-file-name${dataset}`);
        if (fileUpload && fileName) {
          fileUpload.value = '';
          fileName.textContent = 'No file chosen...';
        }
    }
}

// Display the file name after file selection
function displayFileNameSIRVs(type, dataset) {
    // e.g. type = "sirv-2" => looks for "sirv-2-file-upload", "sirv-2-file-name"
    const fileInput       = document.getElementById(`${type}-file-upload${dataset}`);
    const fileNameDisplay = document.getElementById(`${type}-file-name${dataset}`);

    if (!fileInput || !fileNameDisplay) {
        console.warn(`File input or display not found for: ${type}`);
        return;
    }

    if (fileInput.files.length > 0) {
        fileNameDisplay.textContent = fileInput.files[0].name;
        fileNameDisplay.style.color = 'black';
    } else {
        fileNameDisplay.textContent = 'No file chosen...';
        fileNameDisplay.style.color = '#6c6c6c';
    }
}

    // Initialize Choices.js with the option to remove selected items
document.addEventListener('DOMContentLoaded', function () {
    const comparisonDropdown = new Choices('#comparison-dropdown', {
        removeItems: true,
        removeItemButton: true,
        searchEnabled: true,
        placeholderValue: 'Select options',
        shouldSort: false,
        itemSelectText: ''
    });
});

document.addEventListener("DOMContentLoaded", function() {
    const addButton    = document.getElementById("add-dataset-button");
    const removeButton = document.getElementById("remove-dataset-button");
    const boxDataset2  = document.querySelector(".box_dataset2");
    const vert_line    = document.querySelector(".vertical-line")

    // Show the second dataset box on "Add Dataset"
    addButton.addEventListener("click", function() {
        boxDataset2.style.display = "flex";
        removeButton.style.display = "inline-block";  // Show the remove button
        addButton.style.display = "none";
        vert_line.style.height = "91vh";
    });

    // Hide the second dataset box on "Remove Dataset"
    removeButton.addEventListener("click", function() {
        boxDataset2.style.display = "none";
        removeButton.style.display = "none";   // Hide the remove button
        addButton.style.display = 'inline-block';
        vert_line.style.height = "69vh";
    });
});

function start_progress(event) {


    event.preventDefault();  // Prevent default form submission

    document.getElementById('overlay').style.display = 'flex';

    // Collect form data
    var formData = new FormData(document.getElementById('script-form'));

    // Determine which organism value to use
    const selectedOrganism = document.getElementById('organism-dropdown').value;
    const customOrganism = document.getElementById('organism-custom-input').value;
    if (selectedOrganism === 'custom') {
      formData.set('organism', customOrganism);
    } else {
      // Use the selected organism from dropdown
      formData.set('organism', selectedOrganism);
    }

    const transcriptomeFile = document.getElementById('transcriptome_dataset1');
    if (transcriptomeFile.files.length > 0) {
        formData.append('file', transcriptomeFile.files[0]);
      }

    const selectedPlatform = document.getElementById('platform-dropdown').value;
    const customPlatform = document.getElementById('platform-custom-input').value;
    if (selectedPlatform === 'custom') {
      formData.set('platform', customPlatform);
    } else {
      formData.append('platform', selectedPlatform);
    }

    const selectedLibrary = document.getElementById('library-dropdown').value;
    const customLibrary = document.getElementById('library-custom-input').value;
    if (selectedLibrary === 'custom') {
      formData.set('library_preparation', customLibrary);
    } else {
      formData.append('library_preparation', selectedLibrary);
    }

    const toolInputElement = document.getElementById('tool-input');
    const toolName = toolInputElement.value.trim() === '' ? 'your_tool' : toolInputElement.value.trim();
    formData.append('tool', toolName);

    const selectedDataCategory = document.getElementById('data-category-dropdown').value;
    formData.append('data_category', selectedDataCategory);

    // Check if second dataset elements exist (if user clicked + Add Dataset)
    const fileUpload2 = document.getElementById('transcriptome_dataset2');
    const dataset2 = document.getElementById('remove-dataset-button').style.display;

    formData.append('dataset2', dataset2);
    if (dataset2 === 'inline-block') {
      // If a second file was chosen, append it
      if (fileUpload2.files.length > 0) {
        formData.append('file_2', fileUpload2.files[0]);
      }

      // Handle second platform custom field
      const platformDropdown2 = document.getElementById('platform-dropdown2');
      const platformCustomInput2 = document.getElementById('platform-custom-input2');
      if (platformDropdown2.value === 'custom') {
        formData.set('platform_2', platformCustomInput2.value);
      } else {
        formData.set('platform_2', platformDropdown2.value);
      }

      // Handle second library custom field
      const libraryDropdown2 = document.getElementById('library-dropdown2');
      const libraryCustomInput2 = document.getElementById('library-custom-input2');
      if (libraryDropdown2.value === 'custom') {
        formData.set('library_preparation_2', libraryCustomInput2.value);
      } else {
        formData.set('library_preparation_2', libraryDropdown2.value);
      }

      const dataCategoryDropdown2 = document.getElementById('data-category-dropdown2');
      if (dataCategoryDropdown2) {
        const selectedDataCategory2 = dataCategoryDropdown2.value;
        formData.append('data_category_2', selectedDataCategory2);
      }

      // If a second annotation file was chosen, append it
      const annotationInput2 = document.getElementById('annotation-upload2');
      if (annotationInput2 && annotationInput2.files.length > 0) {
        formData.append('annotation_file_2', annotationInput2.files[0]);
      }
      // And also store the dropdown selection
      const annotationDropdown2 = document.getElementById('annotation-dropdown2');
      if (annotationDropdown2) {
        formData.append('annotation_2', annotationDropdown2.value);
      }

      // If a second reference file was chosen, append it
      const referenceInput2 = document.getElementById('reference-upload2');
      if (referenceInput2 && referenceInput2.files.length > 0) {
        formData.append('reference_file_2', referenceInput2.files[0]);
      }
      const referenceDropdown2 = document.getElementById('reference-dropdown2');
      if (referenceDropdown2) {
        formData.append('reference_2', referenceDropdown2.value);
      }

    }

    // Start the server-side process (Ajax + SSE)
    $.ajax({

        url: "/run_script_challenge1",
        type: "POST",
        data: formData,
        processData: false,  // Prevent jQuery from converting the data
        contentType: false,  // Prevent jQuery from overriding the content type
        success: function(response) {
            console.log(response);

            // Start receiving progress updates via SSE
            const source = new EventSource("/progress_stream");
            source.onmessage = function (event) {
                const data = JSON.parse(event.data);
                const progress = data.progress;
                const message = data.message;

                // Update the progress bar
                document.getElementById("progress-bar").style.width = progress + "%";

                // Update the status message
                document.getElementById("status-message").textContent = message;

                if (progress >= 100) {
                    // Close the SSE connection
                    source.close();
                    // Redirect to the results page
                    window.location.href = "/challenge_results";
                }
            };

            source.onerror = function (event) {
                source.close();
            };
        }
    });
}

const lrgaspToggle = document.getElementById("toggleSwitchLRGASP");
const organismDropdown = document.getElementById("organism-dropdown");
const annotationDropdown = document.getElementById("annotation-dropdown");
const referenceDropdown = document.getElementById("reference-dropdown");
const coverageDropdown = document.getElementById("coverage-dropdown");
const cageDropdown = document.getElementById("cage-dropdown");
const quantDropdown = document.getElementById("quant-dropdown");
const polyADropdown = document.getElementById("polyA-dropdown");


function updateDropdowns() {
  const toggleIsOn = lrgaspToggle.checked;
  const organism = organismDropdown.value;

  // Existing logic for the first dataset
  if (organism === "custom") {
    lrgaspToggle.checked = false;
    annotationDropdown.value = "custom";
    referenceDropdown.value  = "custom";
    coverageDropdown.value    = "custom";
    cageDropdown.value  = "custom";
    quantDropdown.value = "custom";
    polyADropdown.value = "custom";

  } else {
    if (toggleIsOn) {
        annotationDropdown.value = "default";
        referenceDropdown.value  = "default";
        coverageDropdown.value    = "default";
        cageDropdown.value  = "default";
        quantDropdown.value = "default";
        polyADropdown.value = "default";
    } else {
        annotationDropdown.value = "custom";
        referenceDropdown.value  = "custom";
        coverageDropdown.value    = "custom";
        cageDropdown.value  = "custom";
        quantDropdown.value = "custom";
        polyADropdown.value = "custom";
    }
  }

    // New logic for the second dataset dropdowns
    const annotationDropdown2 = document.getElementById("annotation-dropdown2");
    const referenceDropdown2 = document.getElementById("reference-dropdown2");
    const coverageDropdown2  = document.getElementById("coverage-dropdown2");
    const cageDropdown2 = document.getElementById("cage-dropdown2");
    const quantDropdown2 = document.getElementById("quant-dropdown2");
    const polyADropdown2 = document.getElementById("polyA-dropdown2");

  // Existing logic for the first dataset
  if (organism === "custom") {
    lrgaspToggle.checked = false;
    annotationDropdown2.value = "custom";
    referenceDropdown2.value  = "custom";
    coverageDropdown2.value    = "custom";
    cageDropdown2.value  = "custom";
    quantDropdown2.value = "custom";
    polyADropdown2.value = "custom";
  } else {
    if (toggleIsOn) {
        annotationDropdown2.value = "default";
        referenceDropdown2.value  = "default";
        coverageDropdown2.value    = "default";
        cageDropdown2.value  = "default";
        quantDropdown2.value = "default";
        polyADropdown2.value = "default";
    } else {
        annotationDropdown2.value = "custom";
        referenceDropdown2.value  = "custom";
        coverageDropdown2.value    = "custom";
        cageDropdown2.value  = "custom";
        quantDropdown2.value = "custom";
        polyADropdown2.value = "custom";
    }
  }

  // Re-check the visibility of upload rows based on the updated dropdown values:
  toggleFileInput('annotation-dropdown', 'annotation-file-upload')
  toggleFileInput('reference-dropdown', 'reference-file-upload')
  toggleFileInput('coverage-dropdown', 'coverage-file-upload')
  toggleFileInput('cage-dropdown', 'cage-file-upload')
  toggleFileInput('quant-dropdown', 'quant-file-upload')
  toggleFileInput('polyA-dropdown', 'polyA-file-upload')
  toggleFileInput('annotation-dropdown2', 'annotation-file-upload2')
  toggleFileInput('reference-dropdown2', 'reference-file-upload2')
  toggleFileInput('coverage-dropdown2', 'coverage-file-upload2')
  toggleFileInput('cage-dropdown2', 'cage-file-upload2')
  toggleFileInput('quant-dropdown2', 'quant-file-upload2')
  toggleFileInput('polyA-dropdown2', 'polyA-file-upload2')
}

// Whenever user changes the LRGASP toggle:
lrgaspToggle.addEventListener("change", function() {
  updateDropdowns();
});

// Whenever user changes the organism dropdown:
organismDropdown.addEventListener("change", function() {
  updateDropdowns();
});

// Create an EventSource for terminal logs
const terminalLogContainer = document.getElementById("terminal-log-container");
const terminalSource = new EventSource("/terminal_stream");

terminalSource.onmessage = function(event) {
    // Append each new log line to the container
    terminalLogContainer.innerHTML += event.data + "<br>";
    // Auto-scroll to the bottom
    terminalLogContainer.scrollTop = terminalLogContainer.scrollHeight;
};

terminalSource.onerror = function(event) {
    // Optional: close connection on error
    terminalSource.close();
};


</script>
{% endblock %}
</body>
</html>